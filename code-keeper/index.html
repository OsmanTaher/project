<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code & Link Library (Local)</title>

    <!-- Favicon -->
    <link 
      rel="icon" 
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2310b981' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M4 19.5A2.5 2.5 0 0 1 6.5 17H20'/><path d='M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z'/></svg>" 
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- PrismJS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              mono: ["Fira Code", "monospace"],
            },
            colors: {
              beige: {
                DEFAULT: "#EFE2CD",
                dark: "#E5D4B5",
              }
            },
          },
        },
      };
    </script>

    <style>
      body {
        transition: background-color 0.3s, color 0.3s;
      }
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #9ca3af;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }
      
      .text-content-rtl {
          direction: rtl !important;
          text-align: right !important;
          white-space: pre-wrap; 
      }
    </style>
  </head>
  <body class="bg-[#EFE2CD] dark:bg-slate-900 text-slate-800 dark:text-slate-100 min-h-screen font-sans transition-colors duration-300">
    <!-- Header -->
    <header
      id="main-header"
      class="p-6 shadow-sm bg-[#EFE2CD]/95 dark:bg-slate-800/90 border-b border-black/5 dark:border-white/5 transition-colors duration-300 sticky top-0 z-50 backdrop-blur-sm"
    >
      <div class="max-w-6xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-3">
          <div
            class="p-2 rounded-lg bg-emerald-600/10 text-emerald-700 dark:bg-slate-700 dark:text-emerald-400"
          >
            <i data-lucide="library" class="w-8 h-8"></i>
          </div>
          <div>
            <h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white">Code & Link Library</h1>
            <p class="text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1">
              <span class="w-2 h-2 bg-emerald-500 rounded-full"></span> Local Storage Mode
            </p>
          </div>
        </div>
        <div class="flex items-center gap-3">
            <button
            id="theme-toggle"
            class="p-2 rounded-full transition-all bg-black/10 hover:bg-black/20 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-yellow-400"
            title="Toggle Theme"
            >
            <i data-lucide="moon" class="w-5 h-5"></i>
            </button>
        </div>
      </div>
    </header>

    <main class="w-full max-w-6xl mx-auto p-4 md:p-8 flex flex-col gap-8">
      
      <!-- === SECTION 1: ADD BOOKMARK FORM === -->
      <div
        id="bookmark-form-card"
        class="p-6 rounded-2xl border-2 shadow-sm transition-all bg-white border-blue-100/50 dark:bg-slate-800 dark:border-slate-700"
      >
        <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-blue-600 dark:text-blue-400">
          <i data-lucide="link" class="w-5 h-5"></i>
          <span id="bm-form-title">Add Bookmark</span>
        </h2>

        <form id="add-bookmark-form" class="flex flex-col md:flex-row gap-4 items-end">
            <!-- Title Input -->
            <div class="space-y-1 w-full md:w-1/3">
                <label class="text-xs font-bold opacity-70">Title <span class="text-red-500">*</span></label>
                <input
                type="text"
                id="bm-title"
                required
                placeholder="e.g. Google"
                class="w-full p-2.5 rounded-lg border-2 outline-none transition-colors bg-gray-50 border-gray-200 focus:border-blue-500 text-slate-800 dark:bg-slate-700 dark:border-slate-600 dark:text-white dark:placeholder-slate-400"
                />
            </div>

            <!-- URL Input -->
            <div class="space-y-1 w-full md:w-full">
                <label class="text-xs font-bold opacity-70">URL <span class="text-red-500">*</span></label>
                <div class="relative">
                    <input
                        type="url"
                        id="bm-url"
                        required
                        placeholder="https://example.com"
                        class="w-full p-2.5 pl-10 rounded-lg border-2 outline-none transition-colors bg-gray-50 border-gray-200 focus:border-blue-500 text-slate-800 dark:bg-slate-700 dark:border-slate-600 dark:text-white dark:placeholder-slate-400 text-left"
                    />
                    <i data-lucide="globe" class="w-4 h-4 absolute left-3 top-3.5 opacity-40"></i>
                </div>
            </div>

            <div class="flex gap-2 w-full md:w-auto">
                <button
                    type="button"
                    id="bm-cancel-edit"
                    class="hidden w-full md:w-auto px-4 py-2.5 rounded-lg font-bold text-slate-600 bg-gray-200 hover:bg-gray-300 transition-all dark:bg-slate-700 dark:text-slate-200"
                >
                    Cancel
                </button>
                <button
                    type="submit"
                    id="bm-submit-btn"
                    class="w-full md:w-auto px-6 py-2.5 rounded-lg font-bold text-white shadow-md transform active:scale-95 transition-all bg-blue-600 hover:bg-blue-700 whitespace-nowrap flex items-center justify-center gap-2"
                >
                    <i data-lucide="save" class="w-4 h-4"></i> Save
                </button>
            </div>
        </form>
      </div>

      <!-- === SECTION 2: ADD CODE FORM === -->
      <div
        id="code-form-card"
        class="p-6 rounded-2xl border-2 shadow-lg transition-all bg-white border-white/50 dark:bg-slate-800 dark:border-slate-700"
      >
        <div class="flex justify-between items-center mb-4">
             <h2 class="text-xl font-bold flex items-center gap-2 text-emerald-600 dark:text-emerald-400">
                <i data-lucide="code-2" class="w-5 h-5"></i>
                <span id="code-form-title">Add Code / Snippet</span>
            </h2>
            <button onclick="deleteAllCodes()" class="text-xs bg-red-100 hover:bg-red-200 text-red-600 dark:bg-red-900/30 dark:hover:bg-red-900/50 dark:text-red-400 px-3 py-1.5 rounded-lg font-bold transition-colors flex items-center gap-1" title="Delete all saved snippets">
                <i data-lucide="trash-2" class="w-3 h-3"></i> Delete All Saved
            </button>
        </div>

        <form id="add-code-form" class="space-y-4">
            <div class="space-y-1">
                <label class="text-sm font-semibold opacity-80">Title <span class="text-red-500">*</span></label>
                <input
                type="text"
                id="code-title"
                required
                placeholder="Snippet title or note subject"
                class="w-full p-3 rounded-xl border-2 outline-none transition-colors bg-gray-50 border-gray-200 focus:border-emerald-500 text-slate-800 dark:bg-slate-700 dark:border-slate-600 dark:text-white dark:placeholder-slate-400"
                />
            </div>

            <!-- Code/Text Textarea -->
            <div class="space-y-1">
              <label class="text-sm font-semibold opacity-80">Content <span class="text-red-500">*</span></label>
              <textarea
                id="code-content"
                required
                rows="6"
                placeholder="Paste your code or type your note here..."
                class="w-full p-3 rounded-xl border-2 outline-none transition-colors font-mono text-sm bg-slate-900 border-slate-700 focus:border-emerald-500 text-green-400 placeholder-slate-600 resize-none dark:bg-slate-950 dark:border-slate-800"
              ></textarea>
            </div>

            <div class="flex gap-3">
                 <button
                    type="button"
                    id="code-cancel-edit"
                    class="hidden px-6 py-3 rounded-xl font-bold text-slate-600 bg-gray-200 hover:bg-gray-300 transition-all dark:bg-slate-700 dark:text-slate-200"
                >
                    Cancel
                </button>
                <button
                type="submit"
                id="code-submit-btn"
                class="flex-1 py-3 px-4 rounded-xl font-bold text-white shadow-md transform active:scale-95 transition-all bg-emerald-600 hover:bg-emerald-700 flex justify-center items-center gap-2"
                >
                <i data-lucide="save" class="w-5 h-5"></i>
                <span>Save Snippet</span>
                </button>
            </div>
        </form>
      </div>

      <!-- === SECTION 3: DISPLAY AREA === -->
      <div class="w-full space-y-8">
        
        <!-- Search -->
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
             <h3 class="text-xl font-bold opacity-90 text-slate-800 dark:text-white">Library Content</h3>
             <div class="relative w-full md:w-64">
                <input
                type="text"
                id="search-input"
                placeholder="Search..."
                class="pl-10 pr-3 py-2 rounded-lg border-0 shadow-sm bg-white dark:bg-slate-800 dark:border-slate-700 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all w-full text-slate-800 dark:text-white placeholder-slate-400"
                />
                <i data-lucide="search" class="w-4 h-4 absolute left-3 top-2.5 opacity-50 text-slate-500 dark:text-slate-400"></i>
             </div>
        </div>

        <!-- Bookmarks Section (Grid) -->
        <div id="bookmarks-section" class="hidden">
            <h4 class="text-sm font-bold text-blue-700 dark:text-blue-400 mb-3 flex items-center gap-2">
                <i data-lucide="bookmark" class="w-4 h-4"></i> Bookmarks
            </h4>
            <div id="bookmarks-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3">
                <!-- Bookmarks injected here -->
            </div>
        </div>

        <!-- Snippets Section (List) -->
        <div id="snippets-section" class="hidden">
             <h4 class="text-sm font-bold text-emerald-700 dark:text-emerald-400 mb-3 mt-6 flex items-center gap-2">
                <i data-lucide="code" class="w-4 h-4"></i> Snippets & Notes
            </h4>
            <div id="snippets-list" class="space-y-4">
                <!-- Snippets injected here -->
            </div>
        </div>

        <!-- Empty State -->
        <div
          id="empty-state"
          class="hidden flex flex-col items-center justify-center text-center opacity-70 py-20 border-2 border-dashed rounded-2xl border-slate-400/30 dark:border-slate-700"
        >
          <div class="p-4 rounded-full bg-white/50 dark:bg-slate-800 mb-4 text-slate-500 dark:text-slate-400">
            <i data-lucide="layers" class="w-10 h-10"></i>
          </div>
          <h3 class="text-lg font-bold text-slate-800 dark:text-slate-200">Library is empty</h3>
          <p class="text-sm max-w-xs mt-2 opacity-70">
            Use the forms above to add bookmarks or code snippets. Data is saved to your browser.
          </p>
        </div>
      </div>
    </main>

    <!-- Toast Notification -->
    <div
      id="toast"
      class="fixed bottom-6 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full bg-slate-900 dark:bg-white dark:text-slate-900 text-white shadow-xl translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2"
    >
      <i data-lucide="check-circle" class="w-5 h-5 text-green-400 dark:text-green-600"></i>
      <span id="toast-msg">Saved successfully</span>
    </div>

    <!-- JavaScript Logic -->
    <script>
      // --- Global State ---
      const STORAGE_KEY = "my_library_local_v2"; 
      let snippets = [];
      let editingId = null;
      let isDarkMode = false;

      // --- Local Storage Functions ---

      function loadSnippets() {
          try {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                const parsed = JSON.parse(stored);
                if (Array.isArray(parsed)) {
                    snippets = parsed.map(s => ({...s, id: String(s.id)}));
                } else {
                    snippets = [];
                }
            } else {
                snippets = [];
            }
          } catch (e) {
            console.error("Failed to load snippets:", e);
            snippets = [];
          }
      }

      function saveToLocal() {
        try {
            const data = JSON.stringify(snippets);
            localStorage.setItem(STORAGE_KEY, data);
            return true;
        } catch (e) {
            console.error("Save failed:", e);
            if (e.name === 'QuotaExceededError') {
                 showToast("Storage full! Delete some items.", true);
            } else {
                 console.warn("LocalStorage access denied or error. Data is session-only.");
            }
            return false;
        }
      }

      function refreshData() {
        loadSnippets(); // Reload from storage to ensure we show what's truly saved
        renderSnippets(searchInput.value);
      }

      // --- CRUD Operations ---

      function addSnippetToList(data) {
        const newSnippet = {
            id: Date.now().toString(), // Simple unique ID
            createdAt: Date.now(),
            expanded: true, 
            ...data
        };
        snippets.unshift(newSnippet);
        saveToLocal();
        refreshData(); // Refresh UI from storage
        showToast("Added to library");
      }

      function updateSnippetInList(id, newData) {
        snippets = snippets.map(s => s.id === id ? { ...s, ...newData } : s);
        saveToLocal();
        refreshData(); // Refresh UI from storage
        showToast("Updated");
      }

      function deleteSnippetFromList(id) {
        snippets = snippets.filter((s) => s.id !== id);
        saveToLocal();
        refreshData(); // Refresh UI from storage
        showToast("Deleted");
      }

      // --- Global Actions (exposed to window) ---

      window.deleteSnippet = function(id) {
        // Confirmation removed - deletes immediately
        deleteSnippetFromList(String(id));
        if (id === editingId) {
            resetBmForm();
            resetCodeForm();
        }
      }
      
      window.deleteAllCodes = function() {
        // Keeping confirmation for "Delete All" as it's destructive
        if (confirm("Are you sure you want to delete ALL code snippets? This cannot be undone.")) {
            snippets = snippets.filter(s => s.type === 'bookmark');
            saveToLocal();
            refreshData();
            showToast("All snippets deleted");
        }
      }

      window.toggleExpand = function(id) {
        const s = snippets.find(i => i.id === String(id));
        if (s) {
            s.expanded = !s.expanded;
            saveToLocal(); 
            // Here we just re-render without full reload since it's UI state
            renderSnippets(searchInput.value); 
        }
      }

      window.editSnippet = function(id) {
        id = String(id);
        const snippet = snippets.find(s => s.id === id);
        if (!snippet) return;

        // Block editing for non-bookmarks if triggered somehow
        if (snippet.type !== 'bookmark') return;

        editingId = id;

        if (snippet.type === 'bookmark') {
            bmTitleInput.value = snippet.title;
            bmUrlInput.value = snippet.url;
            bmFormTitle.textContent = "Edit Bookmark";
            bmSubmitBtn.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> Update';
            bmCancelBtn.classList.remove('hidden');
            document.getElementById('bookmark-form-card').scrollIntoView({ behavior: 'smooth' });
            bmTitleInput.focus();
            resetCodeForm(false);
        }
        renderSnippets(searchInput.value);
      }

      window.copyCode = function(id) {
        const snippet = snippets.find((s) => s.id === String(id));
        if (snippet) {
            navigator.clipboard.writeText(snippet.code)
                .then(() => showToast("Copied to clipboard"))
                .catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = snippet.code;
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        showToast("Copied to clipboard");
                    } catch (err) {
                        showToast("Failed to copy", true);
                    }
                    document.body.removeChild(textarea);
                });
        }
      }

      window.previewCode = function(id) {
        const snippet = snippets.find((s) => s.id === String(id));
        if (snippet) {
          const w = window.open("", "_blank");
          w.document.write(snippet.code);
          w.document.close();
        }
      }

      // --- Theme Logic ---
      function initTheme() {
        try {
            isDarkMode = localStorage.getItem("theme_code_local") === "dark" || 
                        (!localStorage.getItem("theme_code_local") && window.matchMedia('(prefers-color-scheme: dark)').matches);
        } catch (e) {
            isDarkMode = false;
        }
        applyTheme();
      }

      function applyTheme() {
        const htmlEl = document.documentElement;
        const themeToggleBtn = document.getElementById("theme-toggle");
        
        if (isDarkMode) {
          htmlEl.classList.add('dark');
          themeToggleBtn.innerHTML = '<i data-lucide="sun" class="w-5 h-5"></i>';
        } else {
          htmlEl.classList.remove('dark');
          themeToggleBtn.innerHTML = '<i data-lucide="moon" class="w-5 h-5"></i>';
        }
        try {
            localStorage.setItem("theme_code_local", isDarkMode ? "dark" : "light");
        } catch(e) {}
        lucide.createIcons();
      }

      // --- DOM Elements ---
      const bmForm = document.getElementById("add-bookmark-form");
      const bmTitleInput = document.getElementById("bm-title");
      const bmUrlInput = document.getElementById("bm-url");
      const bmSubmitBtn = document.getElementById("bm-submit-btn");
      const bmCancelBtn = document.getElementById("bm-cancel-edit");
      const bmFormTitle = document.getElementById("bm-form-title");

      const codeForm = document.getElementById("add-code-form");
      const codeTitleInput = document.getElementById("code-title");
      const codeContentInput = document.getElementById("code-content");
      const codeSubmitBtn = document.getElementById("code-submit-btn");
      const codeCancelBtn = document.getElementById("code-cancel-edit");
      const codeFormTitle = document.getElementById("code-form-title");

      const bookmarksSection = document.getElementById("bookmarks-section");
      const bookmarksGrid = document.getElementById("bookmarks-grid");
      const snippetsSection = document.getElementById("snippets-section");
      const snippetsList = document.getElementById("snippets-list");
      const emptyState = document.getElementById("empty-state");
      const searchInput = document.getElementById("search-input");


      // --- Event Listeners ---

      document.getElementById("theme-toggle").addEventListener("click", () => {
        isDarkMode = !isDarkMode;
        applyTheme();
      });

      searchInput.addEventListener("input", (e) => renderSnippets(e.target.value));

      bmForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const title = bmTitleInput.value.trim();
        const url = bmUrlInput.value.trim();

        if (!title || !url) {
            showToast("Please fill in title and URL", true);
            return;
        }

        if (editingId) {
            updateSnippetInList(editingId, { title, url });
            resetBmForm();
        } else {
            addSnippetToList({ type: 'bookmark', title, url, code: null });
            bmTitleInput.value = "";
            bmUrlInput.value = "";
        }
      });

      codeForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const title = codeTitleInput.value.trim();
        const code = codeContentInput.value; 

        if (!title || !code) {
            showToast("Please fill in title and content", true);
            return;
        }

        let type = 'code';
        if (isArabic(code)) type = 'text';

        // Edit mode removed for snippets, so always add new
        addSnippetToList({ type, title, url: null, code });
        codeTitleInput.value = "";
        codeContentInput.value = "";
      });

      bmCancelBtn.addEventListener('click', () => { editingId = null; resetBmForm(); });
      codeCancelBtn.addEventListener('click', () => { editingId = null; resetCodeForm(); });


      // --- Helpers ---

      function resetBmForm(shouldRender = true) {
          if (editingId && snippets.find(s => s.id === editingId)?.type === 'bookmark') {
              editingId = null;
          }
          bmTitleInput.value = "";
          bmUrlInput.value = "";
          bmFormTitle.textContent = "Add Bookmark";
          bmSubmitBtn.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> Save';
          bmCancelBtn.classList.add('hidden');
          if (shouldRender) renderSnippets(searchInput.value);
      }

      function resetCodeForm(shouldRender = true) {
          // No edit mode for snippets anymore, just clear inputs
          codeTitleInput.value = "";
          codeContentInput.value = "";
          codeFormTitle.textContent = "Add Code / Snippet";
          codeSubmitBtn.innerHTML = '<i data-lucide="save" class="w-5 h-5"></i><span>Save Snippet</span>';
          codeCancelBtn.classList.add('hidden');
          if (shouldRender) renderSnippets(searchInput.value);
      }

      function isArabic(text) {
          if (!text) return false;
          const arabicPattern = /[\u0600-\u06FF]/;
          return arabicPattern.test(text);
      }

      function showToast(message, isError = false) {
        const toast = document.getElementById("toast");
        const msgSpan = document.getElementById("toast-msg");
        msgSpan.textContent = message;
        
        const icon = toast.querySelector("i");
        icon.setAttribute("data-lucide", isError ? "alert-circle" : "check-circle");
        
        icon.classList.remove("text-green-400", "text-red-400", "text-green-600", "text-red-600");
        if (isError) {
             icon.classList.add("text-red-400", "dark:text-red-600");
        } else {
             icon.classList.add("text-green-400", "dark:text-green-600");
        }

        lucide.createIcons();
        toast.classList.remove("translate-y-20", "opacity-0");
        setTimeout(() => {
            toast.classList.add("translate-y-20", "opacity-0");
        }, 3000);
      }

      function escapeHtml(text) {
        if (!text) return "";
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
      }


      // --- Render Logic ---

      function renderSnippets(searchTerm = "") {
        if (!Array.isArray(snippets)) snippets = [];

        const filtered = snippets.filter((s) =>
          s.title.toLowerCase().includes(searchTerm.toLowerCase())
        );

        bookmarksSection.classList.add("hidden");
        snippetsSection.classList.add("hidden");
        emptyState.classList.add("hidden");

        if (filtered.length === 0) {
            emptyState.classList.remove("hidden");
            return;
        }

        const bookmarks = filtered.filter(s => s.type === 'bookmark');
        const codeSnippets = filtered.filter(s => s.type !== 'bookmark');

        // Render Bookmarks
        if (bookmarks.length > 0) {
            bookmarksSection.classList.remove("hidden");
            bookmarksGrid.innerHTML = bookmarks.map(bm => {
                const isEditing = bm.id === editingId;
                const borderClass = isEditing 
                    ? "border-blue-500 ring-2 ring-blue-200 dark:ring-blue-900" 
                    : "border-blue-100 dark:border-slate-700 hover:border-blue-300 dark:hover:border-slate-500";
                
                return `
                    <div class="group relative p-3 rounded-xl border ${borderClass} bg-white dark:bg-slate-800 transition-all shadow-sm flex items-center justify-between gap-2">
                        <a href="${bm.url}" target="_blank" class="flex items-center gap-2 flex-1 min-w-0">
                            <div class="p-1.5 rounded-md bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400">
                                <i data-lucide="globe" class="w-4 h-4"></i>
                            </div>
                            <span class="font-bold text-sm truncate text-slate-700 dark:text-slate-200">${escapeHtml(bm.title)}</span>
                        </a>
                        <div class="flex opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="editSnippet('${bm.id}')" class="p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 text-blue-500 transition-all" title="Edit">
                                <i data-lucide="pencil" class="w-3 h-3"></i>
                            </button>
                            <button onclick="deleteSnippet('${bm.id}')" class="p-1.5 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50 text-red-500 transition-all" title="Delete">
                                <i data-lucide="trash-2" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join("");
        }

        // Render Snippets
        if (codeSnippets.length > 0) {
            snippetsSection.classList.remove("hidden");
            snippetsList.innerHTML = codeSnippets.map(snippet => {
                const borderClass = "border-slate-200 dark:border-slate-700";

                const isText = snippet.type === 'text';
                const contentDir = isText ? 'rtl' : 'ltr';
                const contentClass = isText 
                    ? 'text-content-rtl font-sans text-lg text-slate-800 dark:text-slate-200' 
                    : 'font-mono text-sm language-html'; 

                // Note: Edit button removed from HTML template below
                return `
                      <div class="rounded-xl border ${borderClass} bg-white dark:bg-slate-800 overflow-hidden shadow-sm transition-all duration-300">
                        <div class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50" onclick="toggleExpand('${snippet.id}')">
                             <div class="flex items-center gap-3 overflow-hidden">
                                <div class="p-2 rounded-lg bg-opacity-10 ${isText ? "bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400" : "bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400"}">
                                    <i data-lucide="${isText ? 'align-right' : 'code'}" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg truncate text-slate-800 dark:text-slate-100">${escapeHtml(snippet.title)}</h3>
                                    <span class="text-[10px] uppercase font-bold opacity-60 bg-gray-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2 py-0.5 rounded">${snippet.type}</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                ${!isText ? `
                                <button onclick="event.stopPropagation(); previewCode('${snippet.id}')" class="p-2 rounded-full hover:bg-emerald-100 dark:hover:bg-slate-600 text-emerald-500 dark:text-emerald-400 transition-colors" title="Preview">
                                    <i data-lucide="eye" class="w-5 h-5"></i>
                                </button> ` : ''}
                                <div class="transform transition-transform duration-300 ${snippet.expanded ? "rotate-180" : ""}">
                                    <i data-lucide="chevron-down" class="w-5 h-5 opacity-50 text-slate-400"></i>
                                </div>
                            </div>
                        </div>

                        <div class="${snippet.expanded ? "block" : "hidden"} border-t border-slate-100 dark:border-slate-700/50 bg-gray-50 dark:bg-slate-900/50">
                            <div class="p-2 flex justify-end gap-2 border-b border-slate-200 dark:border-slate-700 px-4 py-2">
                                <button onclick="event.stopPropagation(); copyCode('${snippet.id}')" class="text-xs flex items-center gap-1 px-3 py-1.5 rounded-md hover:bg-emerald-100 dark:hover:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 transition-colors font-medium">
                                    <i data-lucide="copy" class="w-3 h-3"></i> Copy
                                </button>
                                <button onclick="event.stopPropagation(); deleteSnippet('${snippet.id}')" class="text-xs flex items-center gap-1 px-3 py-1.5 rounded-md hover:bg-red-100 dark:hover:bg-red-900/30 text-red-500 transition-colors font-medium">
                                    <i data-lucide="trash-2" class="w-3 h-3"></i> Delete
                                </button>
                            </div>
                            <div class="relative group">
                                <pre class="p-4 overflow-x-auto ${contentClass}" dir="${contentDir}"><code class="${!isText ? 'language-html' : ''}">${escapeHtml(snippet.code)}</code></pre>
                            </div>
                        </div>
                      </div>
                `;
            }).join("");
            
            if (window.Prism) {
                setTimeout(() => Prism.highlightAll(), 0);
            }
        }
        lucide.createIcons();
      }

      // Start App
      initTheme();
      loadSnippets();
      renderSnippets();

    </script>
  </body>
</html>
